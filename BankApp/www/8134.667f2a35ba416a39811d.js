(self.webpackChunkBankApp=self.webpackChunkBankApp||[]).push([[8134],{1150:(e,t,n)=>{"use strict";var i;n.d(t,{Z:()=>d});var r=new Uint8Array(16);function o(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&s.test(e)};for(var u=[],c=0;c<256;++c)u.push((c+256).toString(16).substr(1));const d=function(e,t,n){var i=(e=e||{}).random||(e.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=i[r];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n}(i)}},7879:(e,t,n)=>{"use strict";n.d(t,{d:()=>l});var i=n(1855),r=n(6637),o=n(6274),s=n(1150),a=n(3606),u=n(5401),c=n(7104),d=n(4988);let l=(()=>{class e{constructor(e,t,n){this.toastController=e,this.modalCtrl=t,this.db=n,this.minDate=(new Date).getFullYear()-18,this.user={usuario:"",password:"",rol:"",nombre:"",direccion:"",nacimiento:"",telefono:""},this.opt=[{val:"Monetaria",isChecked:!0},{val:"Ahorro",isChecked:!1}]}ngOnInit(){this.init()}init(){return(0,i.mG)(this,void 0,void 0,function*(){this.checked=!1,this.user.password="12345"})}crearCuentas(){return(0,i.mG)(this,void 0,void 0,function*(){const e={usuario:this.user.usuario,numeroCuenta:(0,s.Z)().substring(0,8),saldo:1e3,estado:"activa",tipo:"monetaria"};this.db.createMonetary(e),this.checked&&(e.numeroCuenta=(0,s.Z)().substring(0,8),e.tipo="ahorro",e.saldo=0,this.db.createAccount(e))})}crearUsuario(){return this.user.rol="usuario",this.user.estado="activa",this.db.createUser(this.user).then(e=>e?(this.presentToast("Usuario creado satisfactoriamente","success"),this.crearCuentas(),!0):(this.presentToast("Error al crear el usuario","danger"),!1)),!1}encrypt(){return r.AES.encrypt(this.user.password,"secret key 123").toString()}getDateItem(e){this.user.nacimiento=(0,o.p6)(e.detail.value,"yyyy-MM-dd","en-US")}isChecked(e){this.checked=!e.currentTarget.checked}salirModal(){this.modalCtrl.dismiss()}onSubmit(e){return(0,i.mG)(this,void 0,void 0,function*(){this.user.password=this.encrypt(),""!==this.user.nacimiento?(this.crearUsuario(),this.salirModal()):this.presentToast("Llena todos los campos","danger")})}presentToast(e,t){return(0,i.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({message:e,cssClass:"center",duration:1e3,color:t})).present()})}}return e.\u0275fac=function(t){return new(t||e)(a.Y36(u.yF),a.Y36(u.IN),a.Y36(c.t))},e.\u0275cmp=a.Xpm({type:e,selectors:[["app-create-users"]],decls:46,vars:7,consts:[["translucent","",1,"ion-no-border"],["slot","start"],["expand","block","fill","clear","shape","round",3,"click"],["slot","start","name","arrow-back-outline"],[1,"ion-text-capitalize"],[1,"div-center"],[3,"ngSubmit"],["formulario","ngForm"],["position","floating"],["maxlength","10","pattern","^([a-zA-Z0-9_\\-\\.]+)$","name","usuario","type","text","required","",3,"ngModel","ngModelChange"],["name","password","type","password","placeholder","password","show-hide-input","",3,"ngModel","ngModelChange"],["maxlength","25","pattern","^([a-zA-Z0-9_\\-\\.]+)$","name","nombre","type","text","required","",3,"ngModel","ngModelChange"],["maxlength","100","pattern","^([a-zA-Z0-9_\\-\\.]+)$","name","direccion","type","text","required","",3,"ngModel","ngModelChange"],["name","fecha","displayFormat","MMM DD, YYYY",3,"max","ionChange"],["maxlength","10","pattern","^([0-9_\\-\\.]+)$","name","telefono","inputmode","decimal","type","decimal","required","",3,"ngModel","ngModelChange"],[1,"margin-item"],["disabled","true","mode","ios","checked","true"],["checked","false","mode","ios",3,"click"],["expand","block","color","primary","type","submit",1,"ion-margin",3,"disabled"]],template:function(e,t){if(1&e){const e=a.EpF();a.TgZ(0,"ion-header",0),a.TgZ(1,"ion-toolbar"),a.TgZ(2,"ion-buttons",1),a.TgZ(3,"ion-button",2),a.NdJ("click",function(){return t.salirModal()}),a._uU(4," regresar "),a._UZ(5,"ion-icon",3),a.qZA(),a.qZA(),a.TgZ(6,"ion-title",4),a._uU(7," Crear Usuario "),a.qZA(),a.qZA(),a.qZA(),a.TgZ(8,"ion-content"),a.TgZ(9,"div",5),a.TgZ(10,"form",6,7),a.NdJ("ngSubmit",function(){a.CHM(e);const n=a.MAs(11);return t.onSubmit(n)}),a.TgZ(12,"ion-item-group"),a.TgZ(13,"ion-item"),a.TgZ(14,"ion-label",8),a._uU(15,"Usuario"),a.qZA(),a.TgZ(16,"ion-input",9),a.NdJ("ngModelChange",function(e){return t.user.usuario=e}),a.qZA(),a.qZA(),a.TgZ(17,"ion-item"),a.TgZ(18,"ion-label",8),a._uU(19,"Password"),a.qZA(),a.TgZ(20,"ion-input",10),a.NdJ("ngModelChange",function(e){return t.user.password=e}),a.qZA(),a.qZA(),a.TgZ(21,"ion-item"),a.TgZ(22,"ion-label",8),a._uU(23,"Nombre"),a.qZA(),a.TgZ(24,"ion-input",11),a.NdJ("ngModelChange",function(e){return t.user.nombre=e}),a.qZA(),a.qZA(),a.TgZ(25,"ion-item"),a.TgZ(26,"ion-label",8),a._uU(27,"Direccion"),a.qZA(),a.TgZ(28,"ion-input",12),a.NdJ("ngModelChange",function(e){return t.user.direccion=e}),a.qZA(),a.qZA(),a.TgZ(29,"ion-item"),a.TgZ(30,"ion-label",8),a._uU(31,"Fecha de Nacimiento"),a.qZA(),a.TgZ(32,"ion-datetime",13),a.NdJ("ionChange",function(e){return t.getDateItem(e)}),a.qZA(),a.qZA(),a.TgZ(33,"ion-item"),a.TgZ(34,"ion-label",8),a._uU(35,"Telefono"),a.qZA(),a.TgZ(36,"ion-input",14),a.NdJ("ngModelChange",function(e){return t.user.telefono=e}),a.qZA(),a.qZA(),a.TgZ(37,"ion-item",15),a._UZ(38,"ion-checkbox",16),a.TgZ(39,"ion-label"),a._uU(40,"Monetaria"),a.qZA(),a.TgZ(41,"ion-checkbox",17),a.NdJ("click",function(e){return t.isChecked(e)}),a.qZA(),a.TgZ(42,"ion-label"),a._uU(43,"Ahorro"),a.qZA(),a.qZA(),a.qZA(),a.TgZ(44,"ion-button",18),a._uU(45," Crear Usuario "),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&e){const e=a.MAs(11);a.xp6(16),a.Q6J("ngModel",t.user.usuario),a.xp6(4),a.Q6J("ngModel",t.user.password),a.xp6(4),a.Q6J("ngModel",t.user.nombre),a.xp6(4),a.Q6J("ngModel",t.user.direccion),a.xp6(4),a.Q6J("max",t.minDate),a.xp6(4),a.Q6J("ngModel",t.user.telefono),a.xp6(8),a.Q6J("disabled",e.invalid)}},directives:[u.Gu,u.sr,u.Sm,u.YG,u.gu,u.wd,u.W2,d._Y,d.JL,d.F,u.Ub,u.Ie,u.Q$,u.pK,u.j9,d.nD,d.c5,d.Q7,d.JJ,d.On,u.x4,u.QI,u.nz,u.w],styles:[""]}),e})()},8134:(e,t,n)=>{"use strict";n.r(t),n.d(t,{UsersPageModule:()=>Z});var i=n(6274),r=n(4988),o=n(5401),s=n(3991),a=n(1855),u=n(7879),c=n(3606),d=n(7104),l=n(5264);function g(e,t){1&e&&c._UZ(0,"img",17)}function m(e,t){if(1&e&&c._UZ(0,"img",18),2&e){const e=c.oxw().$implicit;c.Q6J("src",e.img,c.LSH)}}function h(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"ion-item"),c.TgZ(1,"ion-avatar",11),c.YNc(2,g,1,0,"img",12),c.YNc(3,m,1,1,"img",13),c.qZA(),c.TgZ(4,"ion-label"),c.TgZ(5,"h2"),c._uU(6),c.qZA(),c.TgZ(7,"h3"),c._uU(8),c.qZA(),c.TgZ(9,"p"),c._uU(10),c.qZA(),c.qZA(),c.TgZ(11,"ion-buttons",2),c.TgZ(12,"ion-button",14),c.NdJ("click",function(){const t=c.CHM(e).$implicit;return c.oxw().bannearUsuario(t)}),c._UZ(13,"ion-icon",15),c.qZA(),c.TgZ(14,"ion-button",14),c.NdJ("click",function(){const t=c.CHM(e).$implicit;return c.oxw().eliminar(t)}),c._UZ(15,"ion-icon",16),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.$implicit;c.xp6(2),c.Q6J("ngIf",void 0===e.img),c.xp6(1),c.Q6J("ngIf",void 0!==e.img),c.xp6(3),c.Oqu(e.usuario),c.xp6(2),c.Oqu(e.estado),c.xp6(2),c.hij("Telefono: ",e.telefono,"")}}const p=[{path:"",component:(()=>{class e{constructor(e,t,n,i,r,o){this.db=e,this.storage=t,this.router=n,this.toastController=i,this.modalCtrl=r,this.alertController=o,this.minDate=(new Date).getFullYear()-18,this.user={usuario:"",password:"",rol:"",nombre:"",direccion:"",nacimiento:"",telefono:""},this.users=[],this.currentUser={usuario:void 0,isAdmin:!0}}ngOnInit(){return(0,a.mG)(this,void 0,void 0,function*(){yield this.getUsers()})}doRefresh(e){setTimeout(()=>(0,a.mG)(this,void 0,void 0,function*(){yield this.db.getUsers().then(e=>{this.users=e.data.usuarios}),e.target.complete()}),1500)}eliminar(e){"admin"!==e.usuario&&this.presentAlertConfirm("Eliminar Usuario",`\xbfDeseas eliminar a ${e.usuario}?`,"eliminar",e)}eliminarUsuario(e){return(0,a.mG)(this,void 0,void 0,function*(){yield this.db.deleteUser(e.usuario).then(e=>{e?this.presentToast("Usuario eliminado","success"):this.presentToast("Error al eliminar","danger")}),yield this.db.deleteMonetary(e.usuario).then(e=>{e?this.presentToast("Cuenta monetaria eliminada","success"):this.presentToast("Error al eliminar cuenta monetaria","danger")}),yield this.db.getUserAccounts(e.usuario).then(e=>{const t=e.data.cuentas;if(t.length>0)for(const n of t)this.db.deleteAccount(n.numeroCuenta).then(e=>{e?this.presentToast("Cuenta eliminada","success"):this.presentToast("Error al eliminar cuenta","danger")})})})}cerrarSesion(){this.presentAlertConfirm("Cerrar Sesi\xf3n","Deseas cerrar sesion","endsesion")}bannearUsuario(e){if("admin"!==e.usuario){let t,n;"activa"===e.estado?(n="Bannear usuario",t=`\xbfDeseas bannear a ${e.usuario}?`):(n="Desbannear usuario",t=`\xbfDeseas desbannear a ${e.usuario}?`),this.presentAlertConfirm(n,t,"estado",e)}}ionViewWillEnter(){return(0,a.mG)(this,void 0,void 0,function*(){this.currentUser=yield this.storage.getCurrentUser(),void 0===this.currentUser?(yield this.presentToast("Sesion expirada","danger"),this.router.navigate(["/"])):yield this.getUsers()})}getUsers(){return(0,a.mG)(this,void 0,void 0,function*(){yield this.db.getUsers().then(e=>{this.users=e.data.usuarios})})}modifyUser(e,t){return(0,a.mG)(this,void 0,void 0,function*(){let n=[];yield this.db.getUserAccounts(e.usuario).then(e=>{n=e.data.cuentas}),yield this.db.modifyPass(e.usuario,"estado",t),yield this.db.modifyMonetary(e.usuario,"estado",t),yield n.forEach(e=>{this.db.modifyAccount(e.numeroCuenta,"estado",t)})})}mostrarModalCreate(){return(0,a.mG)(this,void 0,void 0,function*(){const e=yield this.modalCtrl.create({component:u.d,componentProps:{}});yield e.present(),yield this.getUsers(),e.onWillDismiss()})}presentToast(e,t){return(0,a.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({cssClass:"center",message:e,duration:1e3,color:t})).present()})}presentAlertConfirm(e,t,n,i){return(0,a.mG)(this,void 0,void 0,function*(){let r,o,s;const a=yield this.alertController.create({cssClass:"my-custom-class",header:e,message:t,buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Aceptar",handler:()=>{switch(n){case"endsesion":this.currentUser={usuario:void 0,isAdmin:!1},this.storage.guardarCurrentUser(this.currentUser),this.router.navigate(["/"]);break;case"estado":"activa"===i.estado?(r="danger",o="Usuario banneado",s="inactiva"):(r="success",o="Usuario desbanneado",s="activa"),this.modifyUser(i,s),this.presentToast(o,r);break;case"eliminar":this.eliminarUsuario(i)}}}]});yield a.present()})}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(d.t),c.Y36(l.q),c.Y36(s.F0),c.Y36(o.yF),c.Y36(o.IN),c.Y36(o.Br))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-users"]],decls:14,vars:3,consts:[[3,"translucent"],["capitalize","",1,"ion-text-center"],["slot","end"],["color","success",3,"click"],["slot","start","name","person-add-outline"],["color","danger",3,"click"],["name","exit-outline"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["pullingIcon","chevron-down-circle-outline","pullingText","Actualizar","refreshingSpinner","circles","refreshingText","Actualizando..."],[4,"ngFor","ngForOf"],["slot","start"],["src","../../../assets/images/profile-photo/empty.png",4,"ngIf"],[3,"src",4,"ngIf"],["fill","clear","slot","end",3,"click"],["color","warning","name","ban-outline"],["color","danger","name","close-circle-outline"],["src","../../../assets/images/profile-photo/empty.png"],[3,"src"]],template:function(e,t){1&e&&(c.TgZ(0,"ion-header",0),c.TgZ(1,"ion-toolbar"),c.TgZ(2,"ion-title",1),c._uU(3," Administrar Usuarios "),c.qZA(),c.TgZ(4,"ion-buttons",2),c.TgZ(5,"ion-button",3),c.NdJ("click",function(){return t.mostrarModalCreate()}),c._UZ(6,"ion-icon",4),c.qZA(),c.TgZ(7,"ion-button",5),c.NdJ("click",function(){return t.cerrarSesion()}),c._UZ(8,"ion-icon",6),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(9,"ion-content",7),c.TgZ(10,"ion-refresher",8),c.NdJ("ionRefresh",function(e){return t.doRefresh(e)}),c._UZ(11,"ion-refresher-content",9),c.qZA(),c.TgZ(12,"ion-list"),c.YNc(13,h,16,5,"ion-item",10),c.qZA(),c.qZA()),2&e&&(c.Q6J("translucent",!0),c.xp6(9),c.Q6J("fullscreen",!0),c.xp6(4),c.Q6J("ngForOf",t.users))},directives:[o.Gu,o.sr,o.wd,o.Sm,o.YG,o.gu,o.W2,o.nJ,o.Wo,o.q_,i.sg,o.Ie,o.BJ,i.O5,o.Q$],styles:[".margin-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}"]}),e})()}];let f=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[s.Bz.forChild(p)],s.Bz]}),e})(),Z=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[i.ez,r.u5,o.Pc,f]]}),e})()}}]);